(function(){"use strict";var j=Object.defineProperty,B=(n,s,o)=>s in n?j(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o,t=(n,s,o)=>(B(n,typeof s!="symbol"?s+"":s,o),o),b=(n,s,o)=>{if(!s.has(n))throw TypeError("Cannot "+o)},a=(n,s,o)=>(b(n,s,"read from private field"),o?o.call(n):s.get(n)),c=(n,s,o)=>{if(s.has(n))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(n):s.set(n,o)},T=(n,s,o,r)=>(b(n,s,"write to private field"),r?r.call(n,o):s.set(n,o),o);const Q=self,C=!!Q.WorkerGlobalScope,V=C||`${self.name??""}`.startsWith("portal"),U={MAXIMIZE:"maximize",MINIMIZE:"minimize",RESTORE:"restore",SET_BADGE:"setBadge",CLOSE:"closeApp",ON_MAXIMIZE:"maximize",ON_MINIMIZE:"minimize",ON_RESTORE:"restore"},L="connection",Y={DISCONNECT:L+".disconnect",ON_DISCONNECT:L+".onDisconnect"},E="element",Z={ADD:E+".add",FIND:E+".find",EXISTS:E+".exists",REMOVE:E+".remove",REPLACE:E+".replace",ADD_STYLES:E+".addStyles",RESTORE_STYLES:E+".restoreStyles",REMOVE_CLASSES:E+".removeClasses",QUERY:E+".query",ON_TOGGLE:E+".onToggle",ON_MUTATION:E+".onMutation",ON_CLICK:E+".onClick",ON_MOUSE_OVER:E+".onMouseOver",ON_HOVER:E+".onHover",ON_MOUSEDOWN:E+".onMouseDown",ON_MOUSEUP:E+".onMouseUp"},M="cookie",m="sessionStorage",A="localStorage",x="cookieStore",z={GET_COOKIE:M+".getItem",SET_COOKIE:M+".setItem",GET_SESSION_STORAGE_ITEM:m+".getItem",SET_SESSION_STORAGE_ITEM:m+".setItem",GET_LOCAL_STORAGE_ITEM:A+".getItem",SET_LOCAL_STORAGE_ITEM:A+".setItem",GET_COOKIE_STORE_ITEM:x+".get",SET_COOKIE_STORE_ITEM:x+".set",ON_COOKIE_CHANGE:M+".onChange",ON_SESSION_STORAGE_CHANGE:m+".onChange",ON_LOCAL_STORAGE_CHANGE:A+".onChange",ON_COOKIE_STORE_CHANGE:x+".onChange"},G=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var s=Math.random()*16|0,o=n=="x"?s:s&3|8;return o.toString(16)}),w={PUSH:"pushNotification",CLEAR:"clearNotifications",ON_CLICK:"notificationClick"},f={SET_RESOURCE:"setResource",CLEAR_RESOURCE:"clearResource",ON_CHANGE:"resourceChange"},D={GET_SESSION:"getSession",ON_CHANGE:"sessionChange"},P={SET_ITEM:"setStoreItem",GET_ITEM:"getStoreItem",REMOVE_ITEM:"removeStoreItem",...z},p={ECHO:"echo",REQUEST_PERMISSIONS:"requestPermissions",SEND_MESSAGE:"sendMessage",OPEN_APP:"openApp",ON_MESSAGE:"message"},k={SET_USER:"setUser",ON_CHANGE:"userChange"},H="0.4.6";var d,u,N,R,I,y,_,q,g;class X{constructor(s,o,r){t(this,"id"),c(this,d,null),c(this,u,[]),c(this,N,new Map),c(this,R,new Map),c(this,I,0),c(this,y,"*"),c(this,_,void 0),t(this,"openApp",(e,i)=>this.sendRequest(p.OPEN_APP,{appId:e,message:i})),c(this,q,(e,i,h=a(this,I))=>new Promise((S,O)=>{let l=null;h&&(l=setTimeout(()=>{O(new Error("timeout"))},h)),a(this,N).set(e,{path:i,timer:l,resolve:S,reject:O})})),c(this,g,async e=>{if(a(this,u).push(e),clearTimeout(a(this,d)),a(this,u).length>=10){this.postMessage({batch:a(this,u)}),a(this,u).length=0;return}T(this,d,setTimeout(()=>{this.postMessage({batch:a(this,u)}),a(this,u).length=0},1))}),t(this,"postMessage",e=>{C?a(this,_).postMessage(e):V&&a(this,_).postMessage(e,a(this,y))}),t(this,"setContext",e=>{T(this,_,e)}),t(this,"sendRequest",async(e,...i)=>{const h=G();return a(this,g).call(this,{id:h,path:e,version:H,args:i}),a(this,q).call(this,h,e)}),t(this,"subscribe",(e,i="*",h)=>{const S=G();return a(this,R).set(S,h),a(this,g).call(this,{id:S,version:H,path:"on."+e,args:[i]}),()=>{a(this,R).delete(S),setTimeout(()=>{this.postMessage({id:S,path:"off."+e,args:[i]})},0)}}),t(this,"disconnect",()=>{a(this,_)&&this.postMessage({id:this.id,path:Y.DISCONNECT})}),t(this,"echo",e=>this.sendRequest(p.ECHO,e)),t(this,"requestPermissions",e=>this.sendRequest(p.REQUEST_PERMISSIONS,e)),t(this,"getSession",async()=>this.sendRequest(D.GET_SESSION)),t(this,"setBadge",e=>this.sendRequest(U.SET_BADGE,e)),t(this,"pushNotification",e=>this.sendRequest(w.PUSH,e)),t(this,"clearNotifications",e=>this.sendRequest(w.CLEAR,e)),t(this,"setStoreItem",(e,i,h)=>this.sendRequest(P.SET_ITEM,e,i,h)),t(this,"getStoreItem",async(e,i,h)=>this.sendRequest(P.GET_ITEM,e,h).then(S=>S??i?i:S)),t(this,"removeStoreItem",(e,i)=>this.sendRequest(P.REMOVE_ITEM,e,i)),t(this,"onSessionChange",e=>this.subscribe(D.ON_CHANGE,"*",e)),t(this,"onResourceChange",(e="*",i)=>this.subscribe(f.ON_CHANGE,e,i)),t(this,"onMessage",e=>this.subscribe(w.ON_CLICK,"*",e)),t(this,"onUserChange",e=>()=>this.subscribe(k.ON_CHANGE,"*",e)),r&&T(this,I,r.requestTimeout||0),this.id=G(),T(this,_,s),o.addEventListener("message",e=>{const{id:i,data:h,error:S}=e.data,O=a(this,N).get(i);if(O)O.timer&&clearTimeout(O.timer),a(this,N).delete(i),S?O.reject(S):O.resolve(h);else{const l=a(this,R).get(i);l&&l(h)}})}}d=new WeakMap,u=new WeakMap,N=new WeakMap,R=new WeakMap,I=new WeakMap,y=new WeakMap,_=new WeakMap,q=new WeakMap,g=new WeakMap;class $ extends X{constructor(s,o){super(s,s,o),t(this,"query",async r=>{const e=typeof r=="string"?r:r.toString();return await this.sendRequest(Z.QUERY,e)}),t(this,"openApp",(r,e)=>this.sendRequest(p.OPEN_APP,{appId:r,message:e})),t(this,"setResource",r=>this.sendRequest(f.SET_RESOURCE,r)),t(this,"clearResource",r=>this.sendRequest(f.CLEAR_RESOURCE,r)),t(this,"setUser",r=>this.sendRequest(k.SET_USER,r)),t(this,"sendMessage",r=>this.sendRequest(p.SEND_MESSAGE,r)),t(this,"generatePathFromProxy",r=>{const e=[],i={get(h,S){return e.push(S.toString()),new Proxy(()=>{},i)},apply(h,S,O){const l=O.map(J=>JSON.stringify(J)).join(", "),K=e[e.length-1];return K==="toString"?e.slice(0,-1).join("."):(e[e.length-1]=`${K}(${l})`,new Proxy(()=>{},i))}};return new Proxy(()=>{},i)}),t(this,"requestPermissions",r=>this.sendRequest(p.REQUEST_PERMISSIONS,r))}}let v;const W=(()=>{if(!C)throw new Error("usePortalService must be called from a web worker");return v||(v=new $(self)),v})(),F={show:!0,text:"2",color:"#f204d9"};W.sendRequest(U.SET_BADGE,F),W.pushNotification({type:"app",title:"Please follow up with Nancy",text:"Nancy needs a follow up appointment.",data:{patientId:"6"},createdAt:new Date})})();
